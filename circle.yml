machine:
  timezone: Europe/London
  php:
    version: 7.0.11

dependencies:
  cache_directories:
  - "ci/cache"
  - "~/.cache/composer"
  pre:
  - rm /opt/circleci/php/$(phpenv global)/etc/conf.d/xdebug.ini

test:
  pre:
  - mkdir -p $CIRCLE_TEST_REPORTS/phpcs
  - cp app/config/secrets_tests.yml app/config/secrets.yml
  override:
  - vendor/bin/php-cs-fixer fix --dry-run --format=junit > $CIRCLE_TEST_REPORTS/phpcs/junit.xml
  - vendor/bin/security-checker security:check
  - vendor/bin/phpunit
  - /opt/circleci/.phpenv/shims/php ci-runner.php phpsw:validate-data
